
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BloodTrack — 完全版 v4</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>BloodTrack — 日次記録（v4 完全版）</h1>
    <p class="sub">日次入力・下書き・編集・月次レポート（PDF出力対応）</p>
  </header>

  <main>
    <section class="card form-card">
      <div class="form-head">
        <label>日付： <input type="date" id="date"></label>
        <div class="controls">
          <button id="draftSave" class="btn draft">📝 下書き保存</button>
          <button id="save" class="btn save">💾 保存する</button>
        </div>
      </div>

      <div class="grid">
        <fieldset class="block"><legend>朝</legend>
          <label>体温 (℃)<input id="morning_temp" type="number" step="0.1"></label>
          <label>リブレ (mg/dL)<input id="morning_libre" type="number"></label>
          <label>単位<input id="morning_unit" type="number"></label>
          <label>朝食後 (mg/dL)<input id="morning_after" type="number"></label>
        </fieldset>

        <fieldset class="block"><legend>昼</legend>
          <label>昼食前 (mg/dL)<input id="noon_before" type="number"></label>
          <label>リブレ (mg/dL)<input id="noon_libre" type="number"></label>
          <label>単位<input id="noon_unit" type="number"></label>
          <label>昼食後 (mg/dL)<input id="noon_after" type="number"></label>
        </fieldset>

        <fieldset class="block"><legend>夜</legend>
          <label>夕食前 (mg/dL)<input id="evening_before" type="number"></label>
          <label>リブレ (mg/dL)<input id="evening_libre" type="number"></label>
          <label>単位<input id="evening_unit" type="number"></label>
          <label>夕食後 (mg/dL)<input id="evening_after" type="number"></label>
        </fieldset>

        <fieldset class="block"><legend>就寝・その他</legend>
          <label>就寝前 (mg/dL)<input id="before_sleep" type="number"></label>
          <label>ランタス (単位)<input id="lantus" type="number"></label>
          <label>朝血圧 上<input id="bp_high" type="number"></label>
          <label>朝血圧 下<input id="bp_low" type="number"></label>
          <label>備考 (10文字)<input id="note" type="text" maxlength="10"></label>
          <label>ルムジェブ残<input id="lumjev_remain" type="number"></label>
          <label>ランタス残<input id="lantus_remain" type="number"></label>
        </fieldset>
      </div>
    </section>

    <section class="card list-card">
      <h2>データ一覧</h2>
      <div id="counts"></div>
      <table id="dataTable"><thead><tr>
        <th>日付</th><th>朝</th><th>昼</th><th>夜</th><th>就寝前</th><th>BP</th><th>残量</th><th>備考</th><th>操作</th>
      </tr></thead><tbody></tbody></table>
      <div class="table-actions">
        <button id="exportCsv" class="btn">CSVエクスポート</button>
        <button id="clearAll" class="btn danger">全削除</button>
      </div>
    </section>

    <section class="card report-card">
      <h2>月次レポート</h2>
      <label>月を選択：<input type="month" id="reportMonth"></label>
      <div id="reportSummary"></div>
      <canvas id="chart" height="220"></canvas>
    </section>

    <section class="card print-card">
      <h2>印刷用 月次表（A4 横）</h2>
      <label>表示する月：<input type="month" id="printMonth"></label>
      <div class="print-actions">
        <button id="renderTable" class="btn">表を表示</button>
        <button id="downloadPdf" class="btn">PDFで出力</button>
      </div>
      <div id="printContainer" class="print-area"></div>
    </section>
  </main>

  <div id="toast" class="toast">保存しました！</div>

  <footer>BloodTrack — Local only. Data stays on your device.</footer>

  <script src="script.js"></script>
</body>
</html>
